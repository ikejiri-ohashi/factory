<%= render "shared/header" %>
<div class="container mx-auto px-8">
  <div class="grid grid-cols-3 gap-4">
    <div class="col-span-2 bg-white rounded-md shadow">
      <div class="flex items-center p-4">
        <span class="material-icons">work</span>
        <p class="ml-2 text-2xl">新規加工依頼一覧</p>
      </div>
      <% @jobs.each do |job|%>
        <div class="p-4 h-auto">
          <hr>
          <div class="flex justify-between items-center">
            <div class="py-4 text-sm flex">
              <%= link_to user_path(job.user.id) do %>
                <p class="hover:underline"><%= job.user.name %></p>
              <% end %>
              さんが<%= job.created_at.to_s(:datetime_jp) %>に投稿
            </div>
            <% @contracts.each do |contract|%>
              <% if contract == job.id %>
                <div class="flex items-center rounded-md border-2 border-green-500">
                  <span class="material-icons">done</span><p class="mx-2">募集は終了しました</p>
                </div>
              <% end %>
            <% end %>
          </div>
          <%= link_to job_path(job.id) do %>
            <div class="text-xl flex">
              <p class="hover:underline"><%= job.name %></p><br>
            </div>
            <div class="pt-2 flex items-center">
              <span class="material-icons">build</span><p class="ml-2">加工種別：</p><%= job.category.name %>
            </div>
            <div class="pt-2 flex items-center">
              <span class="material-icons">location_on</span><p class="ml-2">納品場所：</p><%= job.place.name %><br>
            </div>
            <div class="pt-2 flex items-center">
              <span class="material-icons">schedule</span><p class="ml-2">希望納期： </p><%= job.deadline.name %><br>
            </div>
          <% end %>
        </div>
        
      <% end %>
    </div>
    <div class="col-span-1">
      <div class="bg-white h-auto mb-4 p-2 rounded-md shadow">
        <div class="m-2 flex items-center">
          <%= image_tag("information.png", class:"w-6") %><b class="ml-2">このサービスについて</b>
        </div>
        <p class="p-2">このサービスは金属加工の仕事を依頼したい企業と、その加工技術を持った企業を繋げるサービスです。</p>
      </div>
      <div class="bg-white h-auto mb-4 p-2 rounded-md shadow border-2 border-blue-400">
        <div class="m-2 flex items-center">
          <span class="material-icons">person_search</span><b class="ml-2">あなたへのおすすめ</b>
        </div>
        <% if user_signed_in? %>
          <% unless @matched_category == nil && @matched_place == nil %>
            <%# これより下にメッセージを入れると繰り返し表示してしまう %>
            <% @matched_category.each do |matched_category| %>
              <% unless matched_category.user_id == current_user.id || @contracts.include?(matched_category.id) %>
                <% @matched_place.each do |matched_place|%>
                  <% if matched_category.id == matched_place.id %>
                    <hr>
                    <div class="flex display-start items-center m-2">
                      <%= link_to job_path(matched_place.id) do %>
                        <p class="hover:underline"><%= matched_place.name %></p>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
            <%# これより上にメッセージを入れると繰り返し表示してしまう %>
            <p class="text-sm mx-2 pt-4">ここではあなたの得意技術と所在地を元に、これらの条件が一致している依頼が表示されます。</p>
          <% else %>
            <p class="m-2">プロフィールを登録するとおすすめの仕事が表示されます</p>
          <% end %>
        <% else %>
          <p class="m-2">ログインするとおすすめの仕事が表示されます</p>
        <% end %>
      </div>
      <div class="bg-white h-auto mb-4 p-2 rounded-md shadow">
        <div class="m-2 flex items-center">
          <span class="material-icons">home</span><b class="ml-2">あなたの地域で投稿された依頼</b>
        </div>
        <% if user_signed_in? %>
          <% @matched_place.each do |matched_place|%>
            <% unless matched_place.user_id == current_user.id || @contracts.include?(matched_place.id) %>
              <hr>
              <div class="flex display-start items-center m-2">
                <%= link_to job_path(matched_place.id) do %>
                  <p class="hover:underline"><%= matched_place.name %></p>
                <% end %>
              </div>
            <% end %>
          <% end %>
          <p class="text-sm mx-2 pt-4">ここではあなたの地域で投稿された依頼が表示されます。</p>
        <% else %>
          <p class="m-2">ログインするとあなたの地域で投稿された仕事が表示されます</p>
        <% end %>
      </div>
      <div class="bg-white h-auto mb-4 p-2 rounded-md shadow">
        <div class="m-2 flex items-center">
          <span class="material-icons">trending_up</span><b class="ml-2">注目の仕事ランキング</b>
        </div>
        <% @job_ranks.each.with_index(1) do | job, i | %>
          <div class=" h-auto">
            <hr>
            <div class="flex display-start items-center m-2">
              <div class="ranks">
                <b><%= i %>位 </b>
              </div>
              <div class="ml-2 hover:underline">
                <%= link_to job_path(job.id) do %>
                  <%= job.name %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="bg-white h-auto p-2 rounded-md shadow">
        <div class="m-2 flex items-center">
          <span class="material-icons">people</span><b class="ml-2">新規登録ユーザー</b>
        </div>
        <% @users.each do | user |%>
          <div class=" h-auto">
            <hr>
            <%= link_to user_path(user.id) do %>
              <div class="flex display-start items-center m-2">
                <% if user.profile_image? %>
                  <%= image_tag user.profile_image.url, class: "w-8" %>
                <% else %>
                  <%= image_tag avatar_url(user), class: "w-8" %>
                <% end %>
                <div class="ml-2">
                  <p class="hover:underline"><%= user.name %></p>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    
  </div>
</div>

<%= render "shared/footer" %>